Sub ColorTokensInDocument()
    Dim rng As Range
    Dim txt As String
    Dim pos As Long, startPos As Long, endPos As Long
    Dim token As String, firstChar As String
    
    ' Work on the whole document
    Set rng = ActiveDocument.Content
    rng.Font.Color = wdColorBlack ' reset to black first
    
    txt = rng.Text
    pos = 1
    
    ' Loop through all tokens inside []
    Do While InStr(pos, txt, "[") > 0
        startPos = InStr(pos, txt, "[")
        endPos = InStr(startPos, txt, "]")
        
        If endPos > startPos Then
            token = Mid(txt, startPos, endPos - startPos + 1)
            If Len(token) > 2 Then
                firstChar = Mid(token, 2, 1) ' char after [
                
                ' Apply color based on prefix
                Select Case UCase(firstChar)
                    Case "D"
                        rng.Characters(startPos, Len(token)).Font.Color = wdColorRed
                    Case "K"
                        rng.Characters(startPos, Len(token)).Font.Color = wdColorOrange
                    Case "R"
                        rng.Characters(startPos, Len(token)).Font.Color = wdColorBlue
                    Case "A"
                        rng.Characters(startPos, Len(token)).Font.Color = wdColorGreen
                End Select
            End If
        End If
        
        pos = endPos + 1
    Loop
End Sub
